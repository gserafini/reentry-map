# Tech Debt Audit Report - Reentry Map

**Date:** 2026-02-20
**Health Score:** 5.5/10
**Estimated Total Remediation:** ~40-50 hours

## Summary

| Severity | Count |
| -------- | ----- |
| Critical | 3     |
| High     | 11    |
| Medium   | 10    |
| Low      | 6     |

The codebase has strong foundations (TypeScript, Drizzle ORM, structured API routes, pre-commit hooks) but has accumulated significant debt around security hardcoding, dependency vulnerabilities, type safety shortcuts, test coverage, and documentation sprawl.

## PM Tracking

All critical and high items recorded in pm.db:

- **B003** - Hardcoded DB credentials in 29 files (P0)
- **B004** - 41 npm vulnerabilities (P0)
- **B005** - No security headers (P1)
- **B006** - No rate limiting on 55/57 API routes (P1)
- **B007** - Inconsistent port 6432 in auth routes (P0)
- **I003** - enrichment-agent.ts disables all TS checks (P1)
- **I004** - 18 'as any' casts in production code (P1)
- **I005** - 249 console.log statements in 35 files (P1)
- **I006** - Test coverage at 22% vs 70% target (P1)
- **I007** - 10+ react-hooks/exhaustive-deps eslint-disable (P2)
- **I008** - Documentation sprawl - 209 markdown files (P2)
- **I009** - 6 god files over 700 lines (P2)

## Phase 1: Quick Wins

### 1. [CRITICAL] Hardcoded database credentials in 29 files (B003)

- **Effort:** 30 min
- **Location:** 27 scripts in `scripts/*.mjs`, `lib/auth/config.ts:22`, `app/api/auth/signup/route.ts:18`, `app/api/auth/otp/send/route.ts:17`, plus 3 E2E test files
- **Issue:** Fallback strings contain literal `reentrymap:password@localhost` database credentials committed to git
- **Fix:** Remove all hardcoded fallback connection strings. Make `DATABASE_URL` required (fail fast if missing). Create single `getDbUrl()` utility that throws if env var is absent

### 2. [CRITICAL] 41 npm vulnerability findings (B004)

- **Effort:** 15 min
- **Issue:** 1 critical (next), 23 high (eslint ecosystem, geoip-lite, workbox, axios)
- **Fix:** `npm audit fix`, pin `next` to specific version

### 3. [HIGH] enrichment-agent.ts disables all TypeScript checks (I003)

- **Effort:** 1 hr
- **Location:** `lib/ai-agents/enrichment-agent.ts:1`
- **Issue:** `/* eslint-disable @typescript-eslint/no-explicit-any */` at file top
- **Fix:** Remove file-level eslint-disable, add proper types

### 4. [HIGH] 18 `as any` and `as unknown as` casts (I004)

- **Effort:** 2 hrs
- **Locations:** API routes, admin pages, Leaflet component, verification agent
- **Fix:** Define proper interfaces for API request bodies, agent data, MUI colors

### 5. [HIGH] 249 console.log statements (I005)

- **Effort:** 1 hr
- **Fix:** Remove from production code, implement proper logger

### 6. [HIGH] .bak files and root clutter

- **Effort:** 5 min
- **Fix:** Delete .bak files, add to .gitignore, move screenshots to docs/screenshots/

### 7. [MEDIUM] `next: "latest"` in package.json

- **Effort:** 5 min
- **Fix:** Pin to `"next": "^16.1.6"` or current working version

## Phase 2: Important Fixes

### 8. [HIGH] No security headers (B005)

- **Effort:** Half-day
- **Fix:** Create `middleware.ts` with CSP, HSTS, X-Frame-Options, etc.

### 9. [HIGH] No rate limiting (B006)

- **Effort:** Half-day
- **Fix:** Implement rate-limiting middleware for all public POST endpoints

### 10. [HIGH] Test coverage 22% (I006)

- **Effort:** Multi-session ongoing
- **Fix:** Prioritize API route tests (highest risk, most testable)

### 11. [HIGH] Inconsistent port 6432 in auth routes (B007)

- **Effort:** 10 min
- **Fix:** Unify to 5432 or document PgBouncer setup

### 12. [MEDIUM] react-hooks/exhaustive-deps suppressions (I007)

- **Effort:** Half-day
- **Fix:** Review each case, use useCallback, restructure effects

### 13. [MEDIUM] 26 TODO/FIXME comments (some stale)

- **Effort:** Half-day
- **Fix:** Triage each: implement, remove, or track

## Phase 3: Strategic Improvements

### 14. [MEDIUM] Documentation sprawl (I008)

- **Effort:** Multi-day
- **Fix:** Archive historical docs, keep only active references in root

### 15. [MEDIUM] God files (I009)

- **Effort:** Multi-day
- **Fix:** Break into focused modules

### 16. [MEDIUM] Duplicated admin page patterns

- **Effort:** Half-day
- **Fix:** Create shared `useAdminData()` hook and admin layout

### 17. [MEDIUM] Outdated dependencies

- **Effort:** Half-day
- **Fix:** `npm update`, test thoroughly, match eslint-config-next to Next.js version

### 18. [LOW] Various cleanup

- Screenshot artifacts in root (move to docs/screenshots/)
- `@types/leaflet` in production deps (move to devDependencies)
- Stale Supabase references in CLAUDE.md
- Untracked `data/boulder-county-resources.json`
- Uncommitted deletions

## Metrics

| Metric                           | Value                                             |
| -------------------------------- | ------------------------------------------------- |
| Total Lines of Code              | 58,160                                            |
| Largest file                     | `app/admin/command-center/page.tsx` (1,126 lines) |
| Files over 500 lines             | 14                                                |
| TODO/FIXME/HACK count            | 26                                                |
| Console.log statements           | 249 across 35 files                               |
| `as any` / `as unknown as` casts | 18                                                |
| eslint-disable directives        | 30                                                |
| npm vulnerabilities              | 41 (1 critical, 23 high, 12 moderate, 5 low)      |
| Outdated dependencies            | 39 packages                                       |
| Unit test files                  | 23                                                |
| E2E test files                   | 9                                                 |
| App source files (untested)      | ~80 of 105                                        |
| API routes                       | 57 (0 with unit tests)                            |
| Markdown documentation files     | 209                                               |
